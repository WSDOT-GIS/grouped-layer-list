define(["esri/config","esri/arcgis/utils","esri/dijit/HomeButton","esri/geometry/Extent","esri/geometry/webMercatorUtils","esri/arcgis/Portal","esri/dijit/LayerList"],function(t,e,n,r,o,a,i){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(r,o,function(e){return t[e]}.bind(null,o));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=11)}([function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(2),o=r.__importDefault(n(8)),a=n(9);function i(t,e){var n,o=("string"==typeof t?document.getElementById(t):t).querySelectorAll(".esriList > li"),a=function(t){var e=new Map,n=function(n){t.hasOwnProperty(n)&&t[n].forEach(function(t){return e.set(t,n)})};for(var r in t)n(r);return e}(e),i=0,s=new Map;return o.forEach(function(t){var e=t.querySelector("label");if(e){var r=e.textContent,o=a.get(r)||"Other";if(o!==n){var c="layer-list-group-"+i;s.set(c,o),t.classList.add("layer-list-group-start",c),i++}n=o}}),Array.from(s,function(t){var e=r.__read(t,2);return"."+e[0]+":before { content: '"+e[1]+"' }"}).join("\n")}e.getGroupsFromCreateMapItem=function(t){if(t.itemData.applicationProperties){var e=t.itemData.applicationProperties;if(e.viewing){var n=e.viewing;if(n.layerGrouping){var r=n.layerGrouping;if(r&&r.enabled&&r.groups)return r.groups}}}return null},e.convertLayer=function(t){var e=t.id,n=t.title,r=t.visibility,o=t.layerObject;return{id:e,title:n,layer:o,visibility:r,showLegend:!0,showOpacitySlider:!0,showSubLayers:!o.layerInfos||o.layerInfos.length>1}};var s=function(t){function e(e,n){var o=this;if(e.groups){var s=e.layers,c=new(Array.bind.apply(Array,r.__spread([void 0],function(t,e,n,o){var a,i,s,c,u,l,f,d,p,h,y,m;return void 0===n&&(n="id"),r.__generator(this,function(b){switch(b.label){case 0:for(c in s=[],t)s.push(c);u=0,b.label=1;case 1:if(!(u<s.length))return[3,10];if(l=s[u],!t.hasOwnProperty(l))return[3,9];f=t[l],d=function(t){var a,i;return r.__generator(this,function(r){switch(r.label){case 0:if(!(a=e.find(function(e){return e[n]===t}))){if(i='No layer found with "'+n+'" of "'+t+'".',o)throw new ReferenceError(i);return console.warn(i),[2,"continue"]}return[4,a];case 1:return r.sent(),[2]}})},b.label=2;case 2:b.trys.push([2,7,8,9]),p=r.__values(f),h=p.next(),b.label=3;case 3:return h.done?[3,6]:(y=h.value,[5,d(y)]);case 4:b.sent(),b.label=5;case 5:return h=p.next(),[3,3];case 6:return[3,9];case 7:return m=b.sent(),a={error:m},[3,9];case 8:try{h&&!h.done&&(i=p.return)&&i.call(p)}finally{if(a)throw a.error}return[7];case 9:return u++,[3,1];case 10:return[2]}})}(e.groups,e.layers,e.groupProperty,e.throwOnGroupNotFound))));s.filter(function(t){return!c.includes(t)}).forEach(function(t){return c.push(t)}),e.layers=c.reverse()}return o=t.call(this,e,n)||this,e.groups&&o.on("load",function(t){var r=i(n,e.groups),o=document.createElement("style");o.textContent=r,document.head.appendChild(o)}),e.metadata&&a.addMetadataTabs(o,e.metadataFormatterPage||void 0),o}return r.__extends(e,t),e}(o.default);e.default=s},function(e,n){e.exports=t},function(t,e,n){"use strict";n.r(e),n.d(e,"__extends",function(){return o}),n.d(e,"__assign",function(){return a}),n.d(e,"__rest",function(){return i}),n.d(e,"__decorate",function(){return s}),n.d(e,"__param",function(){return c}),n.d(e,"__metadata",function(){return u}),n.d(e,"__awaiter",function(){return l}),n.d(e,"__generator",function(){return f}),n.d(e,"__exportStar",function(){return d}),n.d(e,"__values",function(){return p}),n.d(e,"__read",function(){return h}),n.d(e,"__spread",function(){return y}),n.d(e,"__await",function(){return m}),n.d(e,"__asyncGenerator",function(){return b}),n.d(e,"__asyncDelegator",function(){return v}),n.d(e,"__asyncValues",function(){return w}),n.d(e,"__makeTemplateObject",function(){return g}),n.d(e,"__importStar",function(){return _}),n.d(e,"__importDefault",function(){return x});
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function o(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var a=function(){return(a=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function i(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(t);o<r.length;o++)e.indexOf(r[o])<0&&(n[r[o]]=t[r[o]])}return n}function s(t,e,n,r){var o,a=arguments.length,i=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(i=(a<3?o(i):a>3?o(e,n,i):o(e,n))||i);return a>3&&i&&Object.defineProperty(e,n,i),i}function c(t,e){return function(n,r){e(n,r,t)}}function u(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}function l(t,e,n,r){return new(n||(n=Promise))(function(o,a){function i(t){try{c(r.next(t))}catch(t){a(t)}}function s(t){try{c(r.throw(t))}catch(t){a(t)}}function c(t){t.done?o(t.value):new n(function(e){e(t.value)}).then(i,s)}c((r=r.apply(t,e||[])).next())})}function f(t,e){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=e.call(t,i)}catch(t){a=[6,t],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}function d(t,e){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}function p(t){var e="function"==typeof Symbol&&t[Symbol.iterator],n=0;return e?e.call(t):{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}}function h(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,a=n.call(t),i=[];try{for(;(void 0===e||e-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(o)throw o.error}}return i}function y(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(h(arguments[e]));return t}function m(t){return this instanceof m?(this.v=t,this):new m(t)}function b(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,o=n.apply(t,e||[]),a=[];return r={},i("next"),i("throw"),i("return"),r[Symbol.asyncIterator]=function(){return this},r;function i(t){o[t]&&(r[t]=function(e){return new Promise(function(n,r){a.push([t,e,n,r])>1||s(t,e)})})}function s(t,e){try{(n=o[t](e)).value instanceof m?Promise.resolve(n.value.v).then(c,u):l(a[0][2],n)}catch(t){l(a[0][3],t)}var n}function c(t){s("next",t)}function u(t){s("throw",t)}function l(t,e){t(e),a.shift(),a.length&&s(a[0][0],a[0][1])}}function v(t){var e,n;return e={},r("next"),r("throw",function(t){throw t}),r("return"),e[Symbol.iterator]=function(){return this},e;function r(r,o){e[r]=t[r]?function(e){return(n=!n)?{value:m(t[r](e)),done:"return"===r}:o?o(e):e}:o}}function w(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,n=t[Symbol.asyncIterator];return n?n.call(t):(t=p(t),e={},r("next"),r("throw"),r("return"),e[Symbol.asyncIterator]=function(){return this},e);function r(n){e[n]=t[n]&&function(e){return new Promise(function(r,o){(function(t,e,n,r){Promise.resolve(r).then(function(e){t({value:e,done:n})},e)})(r,o,(e=t[n](e)).done,e.value)})}}}function g(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function _(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}function x(t){return t&&t.__esModule?t:{default:t}}},function(t,n){t.exports=e},function(t,e){t.exports=n},function(t,e){t.exports=r},function(t,e){t.exports=o},function(t,e){t.exports=a},function(t,e){t.exports=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(2),o=n(10),a="https://wsdot-gis.github.io/geospatial-metadata";function i(t,e){return void 0===e&&(e=a),e?e+"?"+("url="+encodeURIComponent(t+"?f=xml")):t}e.addMetadataTabs=function(t,e){void 0===e&&(e=a),t.on("load",function(n){n.target.querySelectorAll(".esriTitleContainer > input[type=checkbox]").forEach(function(n){n.addEventListener("click",function(n){if(this.dataset.layerIndex){var a,s=parseInt(this.dataset.layerIndex,10),c=t.layers[s];try{a=this.parentElement.parentElement.nextElementSibling}catch(t){if(!(t instanceof TypeError))throw t}a&&function(t,e,n,a){r.__awaiter(this,void 0,void 0,function(){var s,c,u,l,f,d,p,h,y,m,b;return r.__generator(this,function(r){switch(r.label){case 0:return e&&e.layer&&e.layer.url?(s=e.layer.url,[4,o.detectLayerMetadataSupport(s)]):[2];case 1:return r.sent()?[4,o.getMetadataLinks(s)]:[2];case 2:for(h in c=r.sent(),(u=document.createElement("li")).tabIndex=0,u.dataset.tabId="metadata",u.dataset.layerIndex=n.toString(10),u.setAttribute("role","tab"),u.classList.add("esriTabMenuItem"),u.textContent="Metadata",(l=document.createElement("div")).classList.add("esriTab","metadata-panel"),l.setAttribute("role","tabpanel"),l.dataset.tabId="metadata",f=t.firstElementChild,d=t.children[1],f.appendChild(u),d.appendChild(l),(p=document.createElement("ul")).classList.add("layer-metadata-list"),c)c.hasOwnProperty(h)&&(y=c[h],(m=document.createElement("a")).target="wsdot-metadata",m.href=i(y,a),m.textContent=h,(b=document.createElement("li")).appendChild(m),p.appendChild(b));return l.appendChild(p),[2]}})})}(a,c,s,e)}},{once:!0,passive:!0})})})}},function(t,e,n){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),a=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(o,a){function i(t){try{c(r.next(t))}catch(t){a(t)}}function s(t){try{c(r.throw(t))}catch(t){a(t)}}function c(t){t.done?o(t.value):new n(function(e){e(t.value)}).then(i,s)}c((r=r.apply(t,e||[])).next())})},i=this&&this.__generator||function(t,e){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=e.call(t,i)}catch(t){a=[6,t],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}};Object.defineProperty(e,"__esModule",{value:!0});var s="exts/LayerMetadata/validLayers?f=json",c="exts/LayerMetadata/layerSources?f=json",u="exts/LayerMetadata/metadata",l=function(t){function e(e){var n=t.call(this,e.message)||this;return n.errorInfo=e,n.code=e.code,n}return o(e,t),e}(Error);function f(t){return a(this,void 0,void 0,function(){var e;return i(this,function(n){switch(n.label){case 0:return[4,fetch([t,"f=json"].join("?"))];case 1:return[4,n.sent().json()];case 2:if((e=n.sent()).error)throw new l(e.error);return[2,e]}})})}function d(t){return a(this,void 0,void 0,function(){var e;return i(this,function(n){switch(n.label){case 0:return e=[t,c].join("/"),[4,fetch(e)];case 1:return[4,n.sent().json()];case 2:return[2,n.sent()]}})})}e.ArcGisError=l,e.getServiceInfo=f,e.detectLayerMetadataSupport=function(t){return a(this,void 0,void 0,function(){var e;return i(this,function(n){switch(n.label){case 0:return[4,f(t)];case 1:return(e=n.sent()).supportedExtensions?[2,/LayerMetadata/.test(e.supportedExtensions)]:[2,!1]}})})},e.getLayerSources=d,e.getMetadataLinks=function(t,e){return a(this,void 0,void 0,function(){var n,r,o;return i(this,function(a){switch(a.label){case 0:return e?[3,2]:[4,d(t)];case 1:e=a.sent(),a.label=2;case 2:for(o in n=[t,u].join("/"),r={},e)r[o]=[n,e[o][0]].join("/");return[2,r]}})})},e.getValidLayers=function(t){return a(this,void 0,void 0,function(){var e,n;return i(this,function(r){switch(r.label){case 0:return e=[t,s].join("/"),[4,fetch(e)];case 1:return[4,r.sent().json()];case 2:if((n=r.sent()).layerIds)return[2,n.layerIds];throw n.error?new l(n.error):new TypeError("response was not expected type: "+JSON.stringify(n))}})})}},function(t,e,n){"use strict";n.r(e);var r=n(0),o=n.n(r),a=n(3),i=n.n(a),s=n(1),c=n.n(s),u=n(4),l=n.n(u),f=n(5),d=n.n(f);class p extends Error{constructor(t,e){super(`"${t}" does not match expected format: "${e}".`)}}function h(t){t=t||function(t=location.href){const e=/https?\:\/\/([^\.]+)\.github.io\/([^\/]+)/i,n=t.match(e);if(!n)throw new p(t,e);const[,r,o]=n;return`https://www.github.com/${r}/${o}`}();const e=document.createElement("a");e.href=t,e.target="_blank",e.rel="nofollow";const n=document.createElement("span");return n.textContent="Source on GitHub",e.classList.add("github-link"),n.classList.add("github-link__label"),e.appendChild(n),e}var y=n(6),m=n.n(y);const b=["true","on","✓","✔","🗸","🗹","☑","✅"],v=["false","off","⍻","X"];function w(t,e){return function(t,e){let n=t.map(t=>`(?:${t})`).join("|");return e&&(n=`^(?:${n})$`),new RegExp(`${n}`,"i")}(!0===t?b:!1===t?v:b.concat(...v),e)}class g{static parse(t){const e=w(!0,!0),n=w(!1,!0);let r,o=!!e.test(t)||!n.test(t)&&void 0;return void 0===o&&/^\d+(?:[\s,]\d+)*$/.test(t)&&(r=t.split(/\D+/).map(t=>parseInt(t,10)),o=!0),null===o?null:new g({visible:o,visibleLayers:r})}constructor(t){t&&(this.visible=t.visible,this.visibleLayers=t.visibleLayers)}apply(t){const{layer:e}=t;if(!e)return;const n=e;n.suspend&&n.suspend(),null!=this.visible&&(t.visibility=this.visible,e.setVisibility(this.visible)),t.showSubLayers&&this.visibleLayers&&e.setVisibleLayers(this.visibleLayers),n.resume&&n.resume()}toString(){return null==this.visible?"":this.visible?this.visibleLayers?this.visibleLayers.join(" "):"✓":"⍻"}}var _=n(7),x=n.n(_),L=function(t,e,n,r){return new(n||(n=Promise))(function(o,a){function i(t){try{c(r.next(t))}catch(t){a(t)}}function s(t){try{c(r.throw(t))}catch(t){a(t)}}function c(t){t.done?o(t.value):new n(function(e){e(t.value)}).then(i,s)}c((r=r.apply(t,e||[])).next())})};const S="IYrj3otxNjPsrTRD";c.a.defaults.io.httpsDomains.push("wsdot.wa.gov"),c.a.defaults.io.corsEnabledServers.push("wsdot.wa.gov","data.wsdot.wa.gov");const O=function(){const t=function(){return L(this,void 0,void 0,function*(){const t=new x.a.Portal("https://www.arcgis.com"),e=yield t.queryItems({num:100,q:`orgid:${S} AND type:("Web Map" NOT "Application") AND tags:"geoportal"`}),{results:n}=e;return n})}(),e=document.createElement("form");e.action=".",e.classList.add("webmapForm");const n=document.createElement("input");n.name="webmap",n.id="webmapInput",n.type="text",n.required=!0,n.placeholder="ArcGIS webmap id",n.title="value must be hexadecimal webmap ID",n.pattern=/^[a-f0-9]+$/.source;const r=document.createElement("datalist");r.id="webmapList",n.setAttribute("list",r.id);const o=document.createElement("button");return o.type="submit",o.textContent="change map",e.appendChild(n),e.appendChild(r),e.appendChild(o),t.then(t=>{t.forEach(t=>{const e=document.createElement("option");e.textContent=e.value=t.id,e.label=t.title,r.appendChild(e)})},t=>{console.error("AGOL query error",t);const n=new CustomEvent("webmapqueryerror",{detail:{error:t}});e.dispatchEvent(n)}),e}();const P=function(){const t=location.search?location.search.match(/\bwebmap=([a-f0-9]+)\b/i):null;return t?t[1]:"d2666674071e4263ac344046f09b7599"}();i.a.createMap(P,"map",{mapOptions:{extent:function(){const t=new URL(location.href).searchParams.get("map-extent");if(!t)return;const[e,n,r,o]=t.split(/[\s,]/g).map(t=>parseFloat(t));return new d.a({xmin:e,ymin:n,xmax:r,ymax:o,spatialReference:{wkid:4326}})}()||void 0}}).then(t=>{const{map:e,itemInfo:n,errors:a}=t,i=document.createElement("button");i.id="homeButton",e.root.appendChild(i),new l.a({visible:!0,map:e},i).startup(),e.root.appendChild(O);const s=Object(r.getGroupsFromCreateMapItem)(n)||void 0;a&&a.length>0&&(console.group("create map error"),a.forEach(t=>console.error(t)),console.groupEnd());const c=n.itemData.operationalLayers.map(r.convertLayer),u=new o.a({groups:s,groupProperty:"title",map:e,metadata:!0,layers:c,throwOnGroupNotFound:!1},"layerList");!function(t){if(!(window.URL&&window.URLSearchParams&&window.history))throw new Error("Browser must support all of the following features: URL, URLSearchParams, history.");const e=document.createElement("div");e.classList.add("layer-link");const n=document.createElement("a");n.href=new URL(location.href,location.href.replace(/\?.+$/,"")).toString(),n.textContent="📋",n.title="copy URL with layer settings to clipboard",n.target="_blank",n.classList.add("layer-link__anchor"),e.classList.add("layer-link--disabled"),e.appendChild(n),t.map.on("extent-change",({extent:t})=>{t=m.a.webMercatorToGeographic(t);const{xmin:r,ymin:o,xmax:a,ymax:i}=t,s=[r,o,a,i].map(t=>Math.round(1e4*t)/1e4).join(" "),c=new URL(n.href);c.searchParams.set("map-extent",s),n.href=c.toString(),e.classList.remove("layer-link--disabled"),e.classList.remove("layer-link--copied")}),t.on("toggle",function(r){e.classList.remove("layer-link--copied"),e.classList.remove("layer-link--disabled");const{layerIndex:o,visible:a,subLayerIndex:i}=r,s=t.layers[o],c=new URL(n.href),u=c.searchParams.get(s.id),l=u?g.parse(u):null,f=!!l&&null!=l.visibleLayers;let d;d=s.showSubLayers&&(f||null!=i)?new g(s.layer):new g({visible:a}),c.searchParams.set(s.id,d.toString()),n.href=c.toString()}),n.onclick=function(t){const r="Could not copy to clipboard. Right-click link and use context menu to copy link.",o=navigator.clipboard;return o&&o.writeText?(o.writeText(n.href).then(()=>{e.classList.add("layer-link--copied")},t=>{alert(r)}),!1):(alert(r),!1)},t.map.root.appendChild(e)}(u),window.URL&&window.URLSearchParams&&window.history&&u.on("load",()=>{const t=new URL(location.href),{searchParams:e}=t;e&&function(t,e){if(!t||!window.URLSearchParams)return;const n=e.layers;for(const e of n){if(!e.id||!t.has(e.id))continue;const n=t.get(e.id);if(!n)continue;const r=g.parse(n);r?r.apply(e):console.warn(`could not parse "${n}" into layer settings for layer ${e.id}.`)}}(e,u)}),u.startup();try{const t=h("https://www.github.com/wsdot-gis/grouped-layer-list");e.root.appendChild(t)}catch(t){if(!(t instanceof p))throw t}}).catch(t=>{console.error("map creation error",t)})}])});
//# sourceMappingURL=main.js.map