define(["esri/dijit/LayerList","esri/geometry/webMercatorUtils","esri/layers/ArcGISDynamicMapServiceLayer","esri/layers/ArcGISTiledMapServiceLayer","dijit/layout/BorderContainer","dijit/layout/ContentPane","esri/arcgis/utils","esri/config","esri/dijit/HomeButton","esri/geometry/Extent","esri/arcgis/Portal"],((e,t,r,n,a,o,i,s,c,l,u)=>(()=>{"use strict";var f={206:function(e,t){var r,n=this&&this.__extends||(r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},r(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),a=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(a,o){function i(e){try{c(n.next(e))}catch(e){o(e)}}function s(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){e.done?a(e.value):new r((function(t){t(e.value)})).then(i,s)}c((n=n.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var r,n,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(a=2&o[0]?n.return:o[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,o[1])).done)return a;switch(n=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,n=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!((a=(a=i.trys).length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],n=0}finally{r=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var i="exts/LayerMetadata/validLayers?f=json",s="exts/LayerMetadata/layerSources?f=json",c="exts/LayerMetadata/metadata",l=function(e){function t(t){var r=e.call(this,t.message)||this;return r.errorInfo=t,r.code=t.code,r}return n(t,e),t}(Error);function u(e){return a(this,void 0,void 0,(function(){var t;return o(this,(function(r){switch(r.label){case 0:return[4,fetch([e,"f=json"].join("?"))];case 1:return[4,r.sent().json()];case 2:if((t=r.sent()).error)throw new l(t.error);return[2,t]}}))}))}function f(e){return a(this,void 0,void 0,(function(){var t;return o(this,(function(r){switch(r.label){case 0:return t=[e,s].join("/"),[4,fetch(t)];case 1:return[4,r.sent().json()];case 2:return[2,r.sent()]}}))}))}t.ArcGisError=l,t.getServiceInfo=u,t.detectLayerMetadataSupport=function(e){return a(this,void 0,void 0,(function(){var t;return o(this,(function(r){switch(r.label){case 0:return[4,u(e)];case 1:return(t=r.sent()).supportedExtensions?[2,/LayerMetadata/.test(t.supportedExtensions)]:[2,!1]}}))}))},t.getLayerSources=f,t.getMetadataLinks=function(e,t){return a(this,void 0,void 0,(function(){var r,n,a;return o(this,(function(o){switch(o.label){case 0:return t?[3,2]:[4,f(e)];case 1:t=o.sent(),o.label=2;case 2:for(a in r=[e,c].join("/"),n={},t)n[a]=[r,t[a][0]].join("/");return[2,n]}}))}))},t.getValidLayers=function(e){return a(this,void 0,void 0,(function(){var t,r;return o(this,(function(n){switch(n.label){case 0:return t=[e,i].join("/"),[4,fetch(t)];case 1:return[4,n.sent().json()];case 2:if((r=n.sent()).layerIds)return[2,r.layerIds];throw r.error?new l(r.error):new TypeError("response was not expected type: "+JSON.stringify(r))}}))}))}},565:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FormatError=void 0;var n=r(163),a=function(e){function t(t,r){return e.call(this,'"'.concat(t,'" does not match expected format: "').concat(r,'".'))||this}return n.__extends(t,e),t}(Error);t.FormatError=a},935:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createSourceLink=t.githubToGHPagesUrl=t.ghPagesToGithubUrl=void 0;var n=r(163),a=r(565);function o(e){void 0===e&&(e=location.href);var t=/https?\:\/\/([^\.]+)\.github.io\/([^\/]+)/i,r=e.match(t);if(!r)throw new a.FormatError(e,t);var o=n.__read(r,3),i=o[1],s=o[2];return"https://www.github.com/".concat(i,"/").concat(s)}t.ghPagesToGithubUrl=o,t.githubToGHPagesUrl=function(e){void 0===e&&(e=location.href);var t=/https?\:\/\/www.github.com\/([^\/]+)\/([^\/]+)/,r=e.match(t);if(!r)throw new a.FormatError(e,t);var o=n.__read(r,3),i=o[1],s=o[2];return"https://".concat(i,".github.io/").concat(s)},t.createSourceLink=function(e){e=e||o();var t=document.createElement("a");t.href=e,t.target="_blank",t.rel="nofollow";var r=document.createElement("span");return r.textContent="Source on GitHub",t.classList.add("github-link"),r.classList.add("github-link__label"),t.appendChild(r),t}},610:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createWebmapIdForm=void 0;var n=r(163),a=n.__importDefault(r(401));t.createWebmapIdForm=function(e){void 0===e&&(e="select");var t=function(){return n.__awaiter(this,void 0,void 0,(function(){return n.__generator(this,(function(e){switch(e.label){case 0:return[4,new a.default.Portal("https://www.arcgis.com").queryItems({num:100,q:"orgid:".concat("IYrj3otxNjPsrTRD",' AND type:("Web Map" NOT "Application") AND tags:"geoportal"')})];case 1:return[2,e.sent().results]}}))}))}(),r=document.createElement("form");r.action=".",r.classList.add("webmapForm");var o,i,s,c=document.createElement("progress");r.appendChild(c),"select"===e?((o=document.createElement("select")).disabled=!0,o.innerHTML="<option disabled selected>change map</option>",o.name="webmap",r.appendChild(o)):((i=document.createElement("input")).name="webmap",i.id="webmapInput",i.type="text",i.required=!0,i.placeholder="ArcGIS webmap id",i.title="value must be hexadecimal webmap ID",i.pattern=/^[a-f0-9]+$/.source,(s=document.createElement("datalist")).id="webmapList",r.appendChild(i),r.appendChild(s),i.setAttribute("list",s.id));var l=document.createElement("button");return l.type="submit",l.textContent="change map",r.appendChild(l),t.then((function(e){(o||i).disabled=!1,e.forEach((function(e){var t=document.createElement("option");t.value=e.id,t.textContent=t.label=e.title,(o||s).appendChild(t)})),r.removeChild(c)}),(function(e){console.error("AGOL query error",e);var t=new CustomEvent("webmapqueryerror",{detail:{error:e}});r.dispatchEvent(t),r.removeChild(c)})),r}},163:(e,t,r)=>{r.r(t),r.d(t,{__assign:()=>o,__asyncDelegator:()=>g,__asyncGenerator:()=>_,__asyncValues:()=>L,__await:()=>w,__awaiter:()=>u,__classPrivateFieldGet:()=>E,__classPrivateFieldIn:()=>M,__classPrivateFieldSet:()=>j,__createBinding:()=>d,__decorate:()=>s,__exportStar:()=>p,__extends:()=>a,__generator:()=>f,__importDefault:()=>O,__importStar:()=>P,__makeTemplateObject:()=>x,__metadata:()=>l,__param:()=>c,__read:()=>y,__rest:()=>i,__spread:()=>m,__spreadArray:()=>b,__spreadArrays:()=>v,__values:()=>h});var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},n(e,t)};function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var o=function(){return o=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var a in t=arguments[r])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},o.apply(this,arguments)};function i(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(n=Object.getOwnPropertySymbols(e);a<n.length;a++)t.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(e,n[a])&&(r[n[a]]=e[n[a]])}return r}function s(e,t,r,n){var a,o=arguments.length,i=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(a=e[s])&&(i=(o<3?a(i):o>3?a(t,r,i):a(t,r))||i);return o>3&&i&&Object.defineProperty(t,r,i),i}function c(e,t){return function(r,n){t(r,n,e)}}function l(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function u(e,t,r,n){return new(r||(r=Promise))((function(a,o){function i(e){try{c(n.next(e))}catch(e){o(e)}}function s(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,s)}c((n=n.apply(e,t||[])).next())}))}function f(e,t){var r,n,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(a=2&o[0]?n.return:o[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,o[1])).done)return a;switch(n=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,n=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!((a=(a=i.trys).length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],n=0}finally{r=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}var d=Object.create?function(e,t,r,n){void 0===n&&(n=r);var a=Object.getOwnPropertyDescriptor(t,r);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,a)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]};function p(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||d(t,e,r)}function h(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function y(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,a,o=r.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(n=o.next()).done;)i.push(n.value)}catch(e){a={error:e}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(a)throw a.error}}return i}function m(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(y(arguments[t]));return e}function v(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),a=0;for(t=0;t<r;t++)for(var o=arguments[t],i=0,s=o.length;i<s;i++,a++)n[a]=o[i];return n}function b(e,t,r){if(r||2===arguments.length)for(var n,a=0,o=t.length;a<o;a++)!n&&a in t||(n||(n=Array.prototype.slice.call(t,0,a)),n[a]=t[a]);return e.concat(n||Array.prototype.slice.call(t))}function w(e){return this instanceof w?(this.v=e,this):new w(e)}function _(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,a=r.apply(e,t||[]),o=[];return n={},i("next"),i("throw"),i("return"),n[Symbol.asyncIterator]=function(){return this},n;function i(e){a[e]&&(n[e]=function(t){return new Promise((function(r,n){o.push([e,t,r,n])>1||s(e,t)}))})}function s(e,t){try{(r=a[e](t)).value instanceof w?Promise.resolve(r.value.v).then(c,l):u(o[0][2],r)}catch(e){u(o[0][3],e)}var r}function c(e){s("next",e)}function l(e){s("throw",e)}function u(e,t){e(t),o.shift(),o.length&&s(o[0][0],o[0][1])}}function g(e){var t,r;return t={},n("next"),n("throw",(function(e){throw e})),n("return"),t[Symbol.iterator]=function(){return this},t;function n(n,a){t[n]=e[n]?function(t){return(r=!r)?{value:w(e[n](t)),done:"return"===n}:a?a(t):t}:a}}function L(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,r=e[Symbol.asyncIterator];return r?r.call(e):(e=h(e),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(r){t[r]=e[r]&&function(t){return new Promise((function(n,a){!function(e,t,r,n){Promise.resolve(n).then((function(t){e({value:t,done:r})}),t)}(n,a,(t=e[r](t)).done,t.value)}))}}}function x(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}var S=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t};function P(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&d(t,e,r);return S(t,e),t}function O(e){return e&&e.__esModule?e:{default:e}}function E(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)}function j(e,t,r,n,a){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?a.call(e,r):a?a.value=r:t.set(e,r),r}function M(e,t){if(null===t||"object"!=typeof t&&"function"!=typeof t)throw new TypeError("Cannot use 'in' operator on non-object");return"function"==typeof e?t===e:e.has(t)}},766:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LayerSettings=void 0;var n=r(709),a=function(){function e(e){e&&(this.visible=e.visible,this.visibleLayers=e.visibleLayers)}return e.parse=function(t){var r,a=(0,n.makeBooleanRe)(!0,!1),o=(0,n.makeBooleanRe)(!1,!1),i=!!a.test(t)||!o.test(t)&&void 0,s=t.match(/\-?\d+/g);return s&&(r=s.map((function(e){return parseInt(e,10)}))),void 0===i&&r&&(i=!0),null===i?null:new e({visible:i,visibleLayers:r})},e.prototype.apply=function(e){var t=e.layer;if(t){var r=t;r.suspend&&r.suspend(),null!=this.visible&&(e.visibility=this.visible,t.setVisibility(this.visible)),!1!==e.showSubLayers&&this.visibleLayers&&r.setVisibleLayers&&r.setVisibleLayers(this.visibleLayers),r.resume&&r.resume()}},e.prototype.toString=function(){var e=null==this.visible?"":this.visible?"✓":"⍻";return this.visibleLayers?[e].concat(this.visibleLayers.map((function(e){return e.toString(10)}))).join(" "):e},e}();t.LayerSettings=a},858:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.fromGeoportalLayers=void 0;var n=r(163),a=n.__importDefault(r(117)),o=n.__importDefault(r(889));function i(e){var t=e.layerType,r=e.url,n=e.options.id,i=n.replace(/[^a-z0-9]+/gi,"_"),s=e.options.visible||!1,c=e.options.opacity;return{id:i,layer:/Tiled/i.test(t)?new o.default(r,{id:i,visible:s,opacity:c}):new a.default(r,{id:i,visible:s,opacity:c}),showLegend:!0,showOpacitySlider:!0,title:n,visibility:s}}t.fromGeoportalLayers=function(e){var t,r;if(Array.isArray(e))return{groups:r,layers:t=e.map(i)};for(var n in t=new Array,r={},e)if(e.hasOwnProperty(n)){var a=e[n].map(i);a.forEach((function(e){return t.push(e)})),r[n]=a.map((function(e){return e.title}))}return{groups:r,layers:t}}},795:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.convertLayer=t.getGroupsFromCreateMapItem=void 0;var n=r(163),a=n.__importDefault(r(655)),o=r(685);n.__exportStar(r(128),t),n.__exportStar(r(858),t),t.getGroupsFromCreateMapItem=function(e){if(e.itemData.applicationProperties){var t=e.itemData.applicationProperties;if(t.viewing){var r=t.viewing;if(r.layerGrouping){var n=r.layerGrouping;if(n&&n.enabled&&n.groups)return n.groups}}}return null},t.convertLayer=function(e){var t=e.id,r=e.title,n=e.visibility,a=e.layerObject;return{id:t,title:r,layer:a,visibility:n,showLegend:!0,showOpacitySlider:!0,showSubLayers:!a.layerInfos||a.layerInfos.length>1}};var i=function(e){function t(t,r){var a=this;if(t.groups){var i=t.layers,s=new(Array.bind.apply(Array,n.__spreadArray([void 0],n.__read(function(e,t,r,a){var o,i,s,c,l,u,f,d,p,h,y,m;return void 0===r&&(r="id"),n.__generator(this,(function(v){switch(v.label){case 0:for(i in o=[],e)o.push(i);s=0,v.label=1;case 1:if(!(s<o.length))return[3,10];if(c=o[s],!e.hasOwnProperty(c))return[3,9];l=e[c],u=function(e){var o,i;return n.__generator(this,(function(n){switch(n.label){case 0:if(!(o=t.find((function(t){return t[r]===e})))){if(i='No layer found with "'.concat(r,'" of "').concat(e,'".'),a)throw new ReferenceError(i);return console.warn(i),[2,"continue"]}return[4,o];case 1:return n.sent(),[2]}}))},v.label=2;case 2:v.trys.push([2,7,8,9]),y=void 0,f=n.__values(l),d=f.next(),v.label=3;case 3:return d.done?[3,6]:(p=d.value,[5,u(p)]);case 4:v.sent(),v.label=5;case 5:return d=f.next(),[3,3];case 6:return[3,9];case 7:return h=v.sent(),y={error:h},[3,9];case 8:try{d&&!d.done&&(m=f.return)&&m.call(f)}finally{if(y)throw y.error}return[7];case 9:return s++,[3,1];case 10:return[2]}}))}(t.groups,t.layers,t.groupProperty,t.throwOnGroupNotFound)),!1)));i.filter((function(e){return!s.includes(e)})).forEach((function(e){return s.push(e)})),t.layers=s.reverse()}var c="string"===r?r:r instanceof HTMLElement?r.id:null;return(a=e.call(this,t,r)||this)._nodeId=c||"string"==typeof r?r:r.id,t.groups&&a.on("load",(function(e){var a=function(e,t){var r="string"==typeof e?document.getElementById(e):e;r.id&&(r=document.getElementById(r.id)||r);var a,o=r.querySelectorAll(".esriList > li"),i=function(e){var t=new Map,r=function(r){e.hasOwnProperty(r)&&e[r].forEach((function(e){return t.set(e,r)}))};for(var n in e)r(n);return t}(t),s=0,c=new Map;return Array.from(o,(function(e){var t=e.querySelector("label");if(t){var r=t.textContent,n=i.get(r)||"Other";if(n!==a){var o="layer-list-group-".concat(s);c.set(o,n),e.classList.add("layer-list-group-start",o),s++}a=n}})),Array.from(c,(function(e){var t=n.__read(e,2),r=t[0],a=t[1];return".".concat(r,":before { content: '").concat(a,"' }")})).join("\n")}(r,t.groups),o=document.createElement("style");o.textContent=a,document.head.appendChild(o)})),t.metadata&&(0,o.addMetadataTabs)(a,t.metadataOptions),a}return n.__extends(t,e),Object.defineProperty(t.prototype,"root",{get:function(){return document.getElementById(this._nodeId)},enumerable:!1,configurable:!0}),t}(a.default);t.default=i},685:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.addMetadataTabs=t.MetadataOptions=t.isSoeMetadataUrl=t.MetadataSourceEnum=t.defaultFormatterPage=void 0;var n,a=r(163),o=r(206);function i(e){return/\bexts\/LayerMetadata\b/gi.test(e instanceof URL?e.href:e)}function s(e,t){var r,a,o=t.formatterPageUrl,s=t.format,c=t.output,l=t.whatToFormat,u=i(e);if(e instanceof URL||(e=new URL(e)),(o?(null==l&&(l=n.None),u?(a=(l&n.Soe)===n.Soe,console.debug("Current URL is an SOE. Should wrap? ".concat(a))):a=(l&n.BuiltIn)===n.BuiltIn,console.groupEnd(),a):(console.groupEnd(),0))&&o){r=new URL(o);var f=new URL(e);u?f.searchParams.set("f","xml"):(f.searchParams.delete("output"),s&&f.searchParams.set("format",s)),r.searchParams.set("url",f.href)}else r=new URL(e),u?"html"!==c&&r.searchParams.set("f","xml"):(console.debug("is not an SOE"),c&&r.searchParams.set("output",c),s&&r.searchParams.set("format",s));return console.groupEnd(),r}t.defaultFormatterPage="https://wsdot-gis.github.io/geospatial-metadata",function(e){e[e.None=0]="None",e[e.BuiltIn=1]="BuiltIn",e[e.Soe=2]="Soe",e[e.Both=3]="Both"}(n=t.MetadataSourceEnum||(t.MetadataSourceEnum={})),t.isSoeMetadataUrl=i;var c=function(){function e(e){var r=e.format,a=e.output,o=e.formatterPageUrl,i=e.whatToFormat;this.format=r||"fgdc",this.output=a||"html",this.formatterPageUrl=o||t.defaultFormatterPage,this.whatToFormat=i||n.Soe}return e.prototype.wrapMetadataUrl=function(e){return s(e,this)},e}();function l(e){var t=e.match(/^([^\.]+)\.([^\.]+)\.([^\.]+)$/i);if(t){var r=a.__read(t,4),n=r[1],o=r[2],i=r[3],s=document.createElement("span"),c=document.createElement("span"),l=document.createElement("span");s.textContent=n,c.textContent=o,l.textContent=i,s.classList.add("metadata-source-name__db"),c.classList.add("metadata-source-name__schema"),l.classList.add("metadata-source-name__table");var u=document.createDocumentFragment();return[s,c,l].forEach((function(e){u.appendChild(e)})),u}return document.createTextNode(e)}function u(e,t){var r;return a.__awaiter(this,void 0,void 0,(function(){function n(e){c&&e.searchParams.set("format",c),l&&(c||console.warn('Metadata "output" parameter has been set to "'.concat(l,'", but no value was given for the corresponding "format" parameter.')),e.searchParams.set("output",l))}var o,i,s,c,l,u,f,d,p,h,y,m,v,b,w,_,g,L;return a.__generator(this,(function(x){switch(x.label){case 0:return(o=null===(r=e.layer)||void 0===r?void 0:r.url)?(i=/(?:(?:Map)|(?:Feature))Server(\/?)$/g,s=o.match(i),c=t.format,l=t.output,s?(s[1]||(o+="/"),n(u=new URL("".concat(o,"info/metadata"))),f=new URL("".concat(o,"layers?f=json")),[4,fetch(f)]):[2,null]):[2,null];case 1:return[4,x.sent().json()];case 2:d=x.sent(),(_={})["".concat(e.title||"Service")]=u.href,p=_,h=d.layers.filter((function(e){return e.hasMetadata})).map((function(e){var t=new URL("".concat(o).concat(e.id,"/metadata/"));return n(t),[e.name,t.href]}));try{for(y=a.__values(h),m=y.next();!m.done;m=y.next())v=a.__read(m.value,2),b=v[0],w=v[1],p[b]=w}catch(e){g={error:e}}finally{try{m&&!m.done&&(L=y.return)&&L.call(y)}finally{if(g)throw g.error}}return[2,p]}}))}))}t.MetadataOptions=c,t.addMetadataTabs=function(e,r){void 0===r&&(r={format:"fgdc",output:"html",formatterPageUrl:t.defaultFormatterPage,whatToFormat:n.Soe}),e.on("load",(function(t){var n=t.target.querySelectorAll(".esriTitleContainer > input[type=checkbox]:not([data-sublayer-index])");function i(t){if(t.dataset.layerIndex){var n,i=parseInt(t.dataset.layerIndex,10),c=e.layers[i];try{n=function(e){return e.parentElement.parentElement.nextElementSibling}(t)}catch(e){if(!(e instanceof TypeError))throw e}n&&function(e,t,r,n){var i;a.__awaiter(this,void 0,void 0,(function(){var c,f,d,p,h,y,m,v,b,w,_,g;return a.__generator(this,(function(L){switch(L.label){case 0:return(null===(i=null==t?void 0:t.layer)||void 0===i?void 0:i.url)?(n.format,[4,u(t,n)]):[2];case 1:return c=L.sent(),a.__spreadArray([],a.__read(function(e){var t,r,n,o,i;return a.__generator(this,(function(a){switch(a.label){case 0:if(!e)return[2];for(r in t=[],e)t.push(r);n=0,a.label=1;case 1:return n<t.length?(o=t[n],Object.prototype.hasOwnProperty.call(e,o)?(i=e[o],[4,[o,i]]):[3,3]):[3,4];case 2:a.sent(),a.label=3;case 3:return n++,[3,1];case 4:return[2]}}))}(c)),!1).length<=1?(f=t.layer.url,[4,(0,o.detectLayerMetadataSupport)(f)]):[3,4];case 2:return L.sent()?[4,(0,o.getMetadataLinks)(f)]:[2];case 3:c=L.sent(),L.label=4;case 4:for(b in d="metadata",(p=document.createElement("li")).tabIndex=0,p.dataset.tabId=d,p.dataset.layerIndex=r.toString(10),p.setAttribute("role","tab"),p.classList.add("esriTabMenuItem"),p.textContent="Metadata",(h=document.createElement("div")).classList.add("esriTab","metadata-panel"),h.setAttribute("role","tabpanel"),h.dataset.tabId=d,y=e.firstElementChild,m=e.children[1],y.appendChild(p),m.appendChild(h),(v=document.createElement("ul")).classList.add("layer-metadata-list"),c)c.hasOwnProperty(b)&&(w=c[b],(_=document.createElement("a")).target="wsdot-metadata",_.href=s(w,n).href,_.appendChild(l(b)),(g=document.createElement("li")).appendChild(_),v.appendChild(g));return h.appendChild(v),[2]}}))}))}(n,c,i,r)}}Array.from(n,(function(e){e.checked?i(e):e.addEventListener("click",(function(e){i(this)}),{once:!0,passive:!0})}))}))}},709:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.makeBooleanRe=t.makeReGroup=void 0;var n=r(163),a=["true","on","✓","✔","🗸","🗹","☑","✅"],o=["false","off","⍻","X"];function i(e,t){var r=e.map((function(e){return"(?:".concat(e,")")})).join("|");return t&&(r="^(?:".concat(r,")$")),new RegExp("".concat(r),"i")}t.makeReGroup=i,t.makeBooleanRe=function(e,t){return i(!0===e?a:!1===e?o:a.concat.apply(a,n.__spreadArray([],n.__read(o),!1)),t)}},128:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createLayerLink=t.setOperationalLayers=void 0;var n=r(163),a=n.__importDefault(r(672)),o=r(766);t.setOperationalLayers=function(e,t){var r,a;if(e&&window.URLSearchParams)try{for(var i=n.__values(t),s=i.next();!s.done;s=i.next()){var c=s.value;if(c.id&&e.has(c.id)){var l=e.get(c.id);if(l){var u=o.LayerSettings.parse(l);u?u.apply(c):console.warn('could not parse "'.concat(l,'" into layer settings for layer ').concat(c.id,"."))}}}}catch(e){r={error:e}}finally{try{s&&!s.done&&(a=i.return)&&a.call(i)}finally{if(r)throw r.error}}},t.createLayerLink=function(e){if(!(window.URL&&window.URLSearchParams&&window.history))throw new Error("Browser must support all of the following features: URL, URLSearchParams, history.");var t=document.createElement("div");t.classList.add("layer-link");var r=document.createElement("a");r.href=new URL(location.href,location.href.replace(/\?.+$/,"")).toString(),r.textContent="🔗",r.title="Click to update URL with layer and extent paramters.",r.target="_blank",r.classList.add("layer-link__anchor");var n="layer-link--copied",i="layer-link--disabled";t.classList.add(i),t.appendChild(r);var s=e.map.on("extent-change",(function(e){var o=e.extent,s=[(o=a.default.webMercatorToGeographic(o)).xmin,o.ymin,o.xmax,o.ymax].map((function(e){return Math.round(1e4*e)/1e4})).join(" "),c=new URL(r.href);c.searchParams.set("map-extent",s),r.href=c.toString(),t.classList.remove(i),t.classList.remove(n)})),c=e.on("toggle",(function(a){console.group("LayerList toggle event"),t.classList.remove(n),t.classList.remove(i);var s=a.layerIndex,c=a.visible,l=a.subLayerIndex;console.debug("layer: ".concat(s,", sublayer ").concat(l,", visible: ").concat(c));var u=e.layers[s],f=new URL(r.href),d=f.searchParams.get(u.id),p=d?o.LayerSettings.parse(d):null,h=(!!p&&p.visibleLayers,new o.LayerSettings({visible:u.visibility,visibleLayers:u.layer.visibleLayers}));f.searchParams.set(u.id,h.toString()),r.href=f.toString()}));return r.onclick=function(e){if(window.history)return history.replaceState(void 0,document.title,r.href),t.classList.add(n),!1},e.map.root.appendChild(t),{layerToggleHandle:c,extentChangeHandle:s,root:t}}},598:e=>{e.exports=a},48:e=>{e.exports=o},401:e=>{e.exports=u},33:e=>{e.exports=i},957:e=>{e.exports=s},940:e=>{e.exports=c},655:t=>{t.exports=e},436:e=>{e.exports=l},672:e=>{e.exports=t},117:e=>{e.exports=r},889:e=>{e.exports=n}},d={};function p(e){var t=d[e];if(void 0!==t)return t.exports;var r=d[e]={exports:{}};return f[e].call(r.exports,r,r.exports,p),r.exports}p.d=(e,t)=>{for(var r in t)p.o(t,r)&&!p.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},p.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),p.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var h={};return(()=>{var e=h;Object.defineProperty(e,"__esModule",{value:!0});var t=p(163),r=t.__importStar(p(795)),n=t.__importDefault(p(598)),a=t.__importDefault(p(48)),o=t.__importDefault(p(33)),i=t.__importDefault(p(957)),s=t.__importDefault(p(940)),c=t.__importDefault(p(436)),l=p(565),u=p(935),f=p(610);i.default.defaults.io.httpsDomains.push("wsdot.wa.gov"),i.default.defaults.io.corsEnabledServers.push("wsdot.wa.gov","data.wsdot.wa.gov");var d=new n.default({liveSplitters:!0},"container"),y=new a.default({region:"left",style:"width: 300px; padding: 0",splitter:!0},"layerListContainer"),m=new a.default({region:"center",style:"padding: 0"},"mapContainer");d.addChild(y),d.addChild(m),d.startup();var v,b=(0,f.createWebmapIdForm)(),w=(v=location.search?location.search.match(/\bwebmap=([a-f0-9]+)\b/i):null)?v[1]:"d2666674071e4263ac344046f09b7599";o.default.createMap(w,"map",{mapOptions:{extent:function(){var e=new URL(location.href).searchParams.get("map-extent");if(e){var r=t.__read(e.split(/[\s,]/g).map((function(e){return parseFloat(e)})),4),n=r[0],a=r[1],o=r[2],i=r[3];return new c.default({xmin:n,ymin:a,xmax:o,ymax:i,spatialReference:{wkid:4326}})}}()||void 0}}).then((function(e){var t=e.map,n=e.itemInfo,a=e.errors,o=document.createElement("button");o.id="homeButton",t.root.appendChild(o),new s.default({visible:!0,map:t},o).startup(),t.root.appendChild(b);var i=(0,r.getGroupsFromCreateMapItem)(n)||void 0;a&&a.length>0&&(console.group("create map error"),a.forEach((function(e){return console.error(e)})),console.groupEnd());var c=n.itemData.operationalLayers.map(r.convertLayer);if(window.URL&&window.URLSearchParams&&window.history){var f=new URL(location.href).searchParams;f&&(0,r.setOperationalLayers)(f,c)}var d=new r.default({groups:i,groupProperty:"title",map:t,metadata:!0,layers:c,throwOnGroupNotFound:!1},"layerList");(0,r.createLayerLink)(d),d.startup();try{var p=(0,u.createSourceLink)("https://www.github.com/wsdot-gis/grouped-layer-list");t.root.appendChild(p)}catch(e){if(!(e instanceof l.FormatError))throw e}})).catch((function(e){console.error("map creation error",e)}))})(),h})()));
//# sourceMappingURL=main.js.map